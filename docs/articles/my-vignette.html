<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example palmsplusr workflow • palmsplusr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">palmsplusr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/my-vignette.html">Example palmsplusr workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Example palmsplusr workflow</h1>
                        <h4 class="author">Tom Stewart</h4>
            
            <h4 class="date">2017-12-13</h4>
          </div>

    
    
<div class="contents">
<div id="loading-the-palms-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-the-palms-dataset" class="anchor"></a>Loading the PALMS dataset</h3>
<p>PALMS datasets are read in as a csv file, before being converted to a spatial object (known as a “simple feature”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(palmsplusr)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(sf)

palms &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"one_participant.csv"</span>, <span class="dt">package =</span> <span class="st">"palmsplusr"</span>))
palms &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(palms, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</code></pre></div>
</div>
<div id="building-palmsplus" class="section level3">
<h3 class="hasAnchor">
<a href="#building-palmsplus" class="anchor"></a>Building palmsplus</h3>
<p>The <em>palmsplus</em> build process essentially adds additional columns to the input PALMS dataset. However, <em>palmsplusr</em> needs to be told what columns to add, and how to calculate them. This is achieved by building a fields table, as demonstrated below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"duration"</span>,   <span class="st">"1"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"weekday"</span>,    <span class="st">"dow &lt; 6"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"weekend"</span>,    <span class="st">"dow &gt; 5"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"indoors"</span>,    <span class="st">"iov == 3"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"outdoors"</span>,   <span class="st">"iov == 1"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"in_vehicle"</span>, <span class="st">"iov == 2"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"inserted"</span>,   <span class="st">"fixtypecode == 6"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"pedestrian"</span>, <span class="st">"tripmot == 1"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"bicycle"</span>,    <span class="st">"tripmot == 2"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"vehicle"</span>,    <span class="st">"tripmot == 3"</span>)
palmsplus_fields
<span class="co">#&gt; # A tibble: 10 x 3</span>
<span class="co">#&gt;          name          formula domain_field</span>
<span class="co">#&gt;         &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;</span>
<span class="co">#&gt;  1   duration                1         TRUE</span>
<span class="co">#&gt;  2    weekday          dow &lt; 6        FALSE</span>
<span class="co">#&gt;  3    weekend          dow &gt; 5        FALSE</span>
<span class="co">#&gt;  4    indoors         iov == 3         TRUE</span>
<span class="co">#&gt;  5   outdoors         iov == 1         TRUE</span>
<span class="co">#&gt;  6 in_vehicle         iov == 2        FALSE</span>
<span class="co">#&gt;  7   inserted fixtypecode == 6        FALSE</span>
<span class="co">#&gt;  8 pedestrian     tripmot == 1        FALSE</span>
<span class="co">#&gt;  9    bicycle     tripmot == 2        FALSE</span>
<span class="co">#&gt; 10    vehicle     tripmot == 3        FALSE</span></code></pre></div>
<p>The variables contained in the formula can be from the input palms dataset, or from other files you load in. Below is an example of reading in a shapefile, and adding a new field that checks whether a palms point is inside a polygon:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">home &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="kw">system.file</span>(<span class="st">"extdata/shapefiles/"</span>, <span class="st">"home.shp"</span>, <span class="dt">package =</span> <span class="st">"palmsplusr"</span>))
home.buffer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_buffer.html">palms_buffer</a></span>(<span class="dt">point =</span> home, <span class="dt">distance =</span> <span class="dv">100</span>)

<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"at_home"</span>,   <span class="st">"palms_in_polygon(., filter(home.buffer, identifier == i), </span><span class="ch">\"</span><span class="st">identifier</span><span class="ch">\"</span><span class="st">)"</span>)</code></pre></div>
<p>Once all of the fields have been added, you can build the <em>palmsplus</em> table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">palmsplus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_palmsplus.html">palms_calc_palmsplus</a></span>(palms)
<span class="co">#&gt; Computed palmsplus for: BC0627</span>
<span class="kw">names</span>(palmsplus)
<span class="co">#&gt;  [1] "identifier"          "palms_datetime"      "dow"                </span>
<span class="co">#&gt;  [4] "fixtypecode"         "iov"                 "tripnumber"         </span>
<span class="co">#&gt;  [7] "triptype"            "tripmot"             "activity"           </span>
<span class="co">#&gt; [10] "activityintensity"   "activityboutnumber"  "sedentaryboutnumber"</span>
<span class="co">#&gt; [13] "duration"            "weekday"             "weekend"            </span>
<span class="co">#&gt; [16] "indoors"             "outdoors"            "in_vehicle"         </span>
<span class="co">#&gt; [19] "inserted"            "pedestrian"          "bicycle"            </span>
<span class="co">#&gt; [22] "vehicle"             "at_home"             "geometry"</span></code></pre></div>
</div>
<div id="building-days" class="section level3">
<h3 class="hasAnchor">
<a href="#building-days" class="anchor"></a>Building days</h3>
<p>When building the days table, the data are summarised across sereral <em>domains</em>. Domains are added in the same way fields are added. Note that domains needs to be added before palmsplus is built.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"d_home"</span>, <span class="st">"at_home"</span>)
<span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"d_transport"</span>, <span class="st">"pedestrian | bicycle | vehicle"</span>)

palmsplus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_palmsplus.html">palms_calc_palmsplus</a></span>(palms)
<span class="co">#&gt; Computed palmsplus for: BC0627</span>
<span class="kw">names</span>(palmsplus)
<span class="co">#&gt;  [1] "identifier"          "palms_datetime"      "dow"                </span>
<span class="co">#&gt;  [4] "fixtypecode"         "iov"                 "tripnumber"         </span>
<span class="co">#&gt;  [7] "triptype"            "tripmot"             "activity"           </span>
<span class="co">#&gt; [10] "activityintensity"   "activityboutnumber"  "sedentaryboutnumber"</span>
<span class="co">#&gt; [13] "duration"            "weekday"             "weekend"            </span>
<span class="co">#&gt; [16] "indoors"             "outdoors"            "in_vehicle"         </span>
<span class="co">#&gt; [19] "inserted"            "pedestrian"          "bicycle"            </span>
<span class="co">#&gt; [22] "vehicle"             "at_home"             "d_home"             </span>
<span class="co">#&gt; [25] "d_transport"         "geometry"</span></code></pre></div>
<p>Notice there are two additional columns in the palmsplus table. These are used as aggregation domains when the <em>days</em> table is built.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">days &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_days.html">palms_calc_days</a></span>(palmsplus)
<span class="kw">head</span>(days)
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   identifier       date d_home_duration d_home_indoors d_home_outdoors</span>
<span class="co">#&gt;        &lt;chr&gt;     &lt;date&gt;           &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1     BC0627 2013-08-26          348.50              0           79.50</span>
<span class="co">#&gt; 2     BC0627 2013-08-27          929.25              0          532.00</span>
<span class="co">#&gt; 3     BC0627 2013-08-28          651.50              0          494.75</span>
<span class="co">#&gt; 4     BC0627 2013-08-29          353.75              0           57.75</span>
<span class="co">#&gt; 5     BC0627 2013-08-30         1440.00              0          983.50</span>
<span class="co">#&gt; 6     BC0627 2013-08-31         1350.50              0          863.25</span>
<span class="co">#&gt; # ... with 3 more variables: d_transport_duration &lt;dbl&gt;,</span>
<span class="co">#&gt; #   d_transport_indoors &lt;dbl&gt;, d_transport_outdoors &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="building-trajectories" class="section level3">
<h3 class="hasAnchor">
<a href="#building-trajectories" class="anchor"></a>Building trajectories</h3>
<p>Like previously, various fields can be calculated for each trajectory. The variables used in the formulas should be present in the palmsplus table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"mot"</span>,       <span class="st">"first(tripmot)"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"wear"</span>,      <span class="st">"sum(activityintensity &gt;= 0) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"sedentary"</span>, <span class="st">"sum(activityintensity == 0) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"light"</span>,     <span class="st">"sum(activityintensity == 1) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"moderate"</span>,  <span class="st">"sum(activityintensity == 2) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"vigorous"</span>,  <span class="st">"sum(activityintensity == 3) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"mvpa"</span>,      <span class="st">"moderate + vigorous"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trajectories &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_trajectories.html">palms_calc_trajectories</a></span>(palmsplus)
<span class="kw">head</span>(trajectories)
<span class="co">#&gt; Simple feature collection with 6 features and 9 fields</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 174.6973 ymin: -36.80079 xmax: 174.7013 ymax: -36.79289</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   identifier tripnumber mot wear sedentary light moderate vigorous mvpa</span>
<span class="co">#&gt; 1     BC0627          1   1  180        30    45        0      105  105</span>
<span class="co">#&gt; 2     BC0627          2   1  165         0    75       45       45   90</span>
<span class="co">#&gt; 3     BC0627          3   1  555        60   285      150       60  210</span>
<span class="co">#&gt; 4     BC0627          4   1  255        60   135       45       15   60</span>
<span class="co">#&gt; 5     BC0627          5   1  675         0   435      195       45  240</span>
<span class="co">#&gt; 6     BC0627          6   1 1230        90   195      510      435  945</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 LINESTRING (174.69962969 -3...</span>
<span class="co">#&gt; 2 LINESTRING (174.69970838 -3...</span>
<span class="co">#&gt; 3 LINESTRING (174.70103566 -3...</span>
<span class="co">#&gt; 4 LINESTRING (174.69827459 -3...</span>
<span class="co">#&gt; 5 LINESTRING (174.69794882 -3...</span>
<span class="co">#&gt; 6 LINESTRING (174.69952199 -3...</span></code></pre></div>
<p>It is also possible to isolate trjectories that start and end at specific locations. This is done by adding trip start end end criteria before building the trajectories table. Here is an example of trips starting and ending at home. Notice how the “in_home” criteria was created above in the palmsplus table. All the start and end criteria should be pre-calculated to improve performance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_trip_location.html">palms_add_trip_location</a></span>(<span class="st">"home_home"</span>, <span class="st">"at_home"</span>, <span class="st">"at_home"</span>)
trajectories &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_trajectories.html">palms_calc_trajectories</a></span>(palmsplus)
<span class="kw">head</span>(trajectories)
<span class="co">#&gt; Simple feature collection with 6 features and 10 fields</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 174.6973 ymin: -36.80079 xmax: 174.7013 ymax: -36.79289</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   identifier tripnumber mot wear sedentary light moderate vigorous mvpa</span>
<span class="co">#&gt; 1     BC0627          1   1  180        30    45        0      105  105</span>
<span class="co">#&gt; 2     BC0627          2   1  165         0    75       45       45   90</span>
<span class="co">#&gt; 3     BC0627          3   1  555        60   285      150       60  210</span>
<span class="co">#&gt; 4     BC0627          4   1  255        60   135       45       15   60</span>
<span class="co">#&gt; 5     BC0627          5   1  675         0   435      195       45  240</span>
<span class="co">#&gt; 6     BC0627          6   1 1230        90   195      510      435  945</span>
<span class="co">#&gt;   home_home                       geometry</span>
<span class="co">#&gt; 1         0 LINESTRING (174.69962969 -3...</span>
<span class="co">#&gt; 2         0 LINESTRING (174.69970838 -3...</span>
<span class="co">#&gt; 3         0 LINESTRING (174.70103566 -3...</span>
<span class="co">#&gt; 4         0 LINESTRING (174.69827459 -3...</span>
<span class="co">#&gt; 5         0 LINESTRING (174.69794882 -3...</span>
<span class="co">#&gt; 6         0 LINESTRING (174.69952199 -3...</span></code></pre></div>
</div>
<div id="summary-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#summary-plot" class="anchor"></a>Summary plot</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># </span><span class="al">TODO</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Tom Stewart.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
