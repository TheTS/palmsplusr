<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ggplot2 and palmsplusr • palmsplusr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">palmsplusr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="../articles/article-1-getting-started.html">Getting started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/article-1-getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="../articles/article-2-complete-example.html">A complete example</a>
    </li>
    <li>
      <a href="../articles/article-3-building-formulas.html">Building formulas</a>
    </li>
    <li>
      <a href="../articles/article-4-ggplot2-palmsplusr.html">ggplot2 and palmsplusr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="http://github.com/TheTS/palmsplusr/">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>ggplot2 and palmsplusr</h1>
            
            <h4 class="date">2018-01-12</h4>
          </div>

    
    
<div class="contents">
<div id="install-ggplot2" class="section level2">
<h2 class="hasAnchor">
<a href="#install-ggplot2" class="anchor"></a>Install ggplot2</h2>
<p>The development version of ggplot2 contains spatial plotting functions so it needs to be installed from GitHub. You will need to install devtools if you haven’t already.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"tidyverse/ggplot2"</span>)</code></pre></div>
</div>
<div id="plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting" class="anchor"></a>Plotting</h2>
<p>The <code>geom_sf</code> is a new ggplot2 geom specifically for plotting simple features. You can plot points, lines, and polygons. Here is an example plotting one participant’s trajcetories, school and home on a map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(palmsplusr)
<span class="kw">library</span>(ggplot2)

<span class="kw">data</span>(<span class="dt">list =</span> <span class="kw">c</span>(<span class="st">"palms"</span>, <span class="st">"home"</span>, <span class="st">"school"</span>))
home.buffer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_buffer.html">palms_buffer</a></span>(home, <span class="dv">100</span>)

<span class="co"># Load default fields</span>
<span class="kw"><a href="../reference/palms_remove_tables.html">palms_remove_tables</a></span>()
<span class="kw"><a href="../reference/palms_load_defaults.html">palms_load_defaults</a></span>(<span class="kw"><a href="../reference/palms_epoch.html">palms_epoch</a></span>(palms))

<span class="co"># Build palmsplus and trajectories</span>
palmsplus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_build_palmsplus.html">palms_build_palmsplus</a></span>(palms)
<span class="co">#&gt; [1/1] Computed palmsplus for: BC0627</span>
trajectories &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_build_trajectories.html">palms_build_trajectories</a></span>(palmsplus)

<span class="co"># Plot</span>
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>trajectories, <span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">factor</span>(mot)), <span class="dt">lwd =</span> <span class="fl">0.9</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>home.buffer, <span class="kw">aes</span>(<span class="dt">fill=</span><span class="st">"h"</span>), <span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>school, <span class="kw">aes</span>(<span class="dt">fill=</span><span class="st">"s"</span>), <span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"Home (100m)"</span>, <span class="st">"Schoolyard"</span>),
                    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>),
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"Walk"</span>, <span class="st">"Bicycle"</span>, <span class="st">"Vehicle"</span>),
                     <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"1"</span>=<span class="st">"forestgreen"</span>,<span class="st">"2"</span>=<span class="st">"lightblue"</span>,<span class="st">"3"</span>=<span class="st">"orange"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">"Trajectories"</span>, <span class="dt">fill =</span> <span class="st">"Polygons"</span>)</code></pre></div>
<p><img src="article-4-ggplot2-palmsplusr_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>This is an excellent way to visualise and debug your datasets after they have been built. It is easy to loop through all participants in your dataset and save their plots to file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Loop through all unique identifiers</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">unique</span>(trajectories<span class="op">$</span>identifier)) {
  
  <span class="co"># Get geometry for this person only</span>
  t &lt;-<span class="st"> </span>trajectories <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(identifier <span class="op">==</span><span class="st"> </span>i)
  h &lt;-<span class="st"> </span>home.buffer <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(identifier <span class="op">==</span><span class="st"> </span>i)
  s &lt;-<span class="st"> </span>school <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(school_id <span class="op">==</span><span class="st"> </span><span class="kw">as.numeric</span>(participant_basis[participant_basis<span class="op">$</span>identifier <span class="op">==</span><span class="st"> </span>i, <span class="st">"school_id"</span>]))

  <span class="co"># Plot the 3 geometry layers + add colours and title</span>
  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> t, <span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">factor</span>(mot))) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> h, <span class="kw">aes</span>(<span class="dt">fill =</span> <span class="st">"h"</span>), <span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> s, <span class="kw">aes</span>(<span class="dt">fill =</span> <span class="st">"s"</span>), <span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"Home (100m)"</span>, <span class="st">"Schoolyard"</span>),
                      <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>),
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"Walk"</span>, <span class="st">"Bicycle"</span>, <span class="st">"Vehicle"</span>),
                       <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"1"</span>=<span class="st">"forestgreen"</span>,<span class="st">"2"</span>=<span class="st">"lightblue"</span>,<span class="st">"3"</span>=<span class="st">"orange"</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> i, <span class="dt">colour =</span> <span class="st">"Trajectories"</span>, <span class="dt">fill =</span> <span class="st">"Polygons"</span>)

  <span class="co"># Save the plot to file</span>
  <span class="kw">ggsave</span>(<span class="dt">file =</span> <span class="kw">file.path</span>(<span class="st">"plots"</span>, <span class="kw">paste0</span>(i, <span class="st">".png"</span>)), <span class="dt">plot =</span> p, <span class="dt">width =</span> <span class="dv">18</span>, 
         <span class="dt">height =</span> <span class="dv">18</span>, <span class="dt">units =</span> <span class="st">"cm"</span>)
}</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#install-ggplot2">Install ggplot2</a></li>
      <li><a href="#plotting">Plotting</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Tom Stewart.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
