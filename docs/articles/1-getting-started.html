<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with palmsplusr • palmsplusr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">palmsplusr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="../articles/1-getting-started.html">Getting started</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="http://github.com/TheTS/palmsplusr/">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Getting started with palmsplusr</h1>
            
            <h4 class="date">2017-12-20</h4>
          </div>

    
    
<div class="contents">
<div id="loading-palms" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-palms" class="anchor"></a>Loading the PALMS dataset</h2>
<p>A PALMS dataset (in csv format) is read in using the <code><a href="../reference/read_palms.html">read_palms()</a></code> function. This function checks that all required column names are present before converting the csv file to a spatial object. If columns are missing you will receive an error message.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(palmsplusr)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(sf)

palms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_palms.html">read_palms</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"one_participant.csv"</span>, <span class="dt">package =</span> <span class="st">"palmsplusr"</span>))
<span class="kw">names</span>(palms)
<span class="co">#&gt;  [1] "identifier"          "datetime"            "dow"                </span>
<span class="co">#&gt;  [4] "fixtypecode"         "iov"                 "tripnumber"         </span>
<span class="co">#&gt;  [7] "triptype"            "tripmot"             "activity"           </span>
<span class="co">#&gt; [10] "activityintensity"   "activityboutnumber"  "sedentaryboutnumber"</span>
<span class="co">#&gt; [13] "geometry"</span></code></pre></div>
<p>This <code>palms</code> object contains 13 columns. Notice how the <code>lon</code> and <code>lat</code> columns that were present in the csv have been replaced by a <code>geometry</code> column. This is POINT geometry, as each row in <code>palms</code> represents a point.</p>
<p>This <code>palms</code> dataset contains data from 1 participant. You can plot this data to look at the distribution of points in space:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(palms[, <span class="kw">c</span>(<span class="st">"activity"</span>, <span class="st">"tripnumber"</span>)])</code></pre></div>
<p><img src="1-getting-started_files/figure-html/unnamed-chunk-2-1.png" width="576" style="display: block; margin: auto;"></p>
<hr>
<p><br><br></p>
</div>
<div id="building-palmsplus" class="section level2">
<h2 class="hasAnchor">
<a href="#building-palmsplus" class="anchor"></a>Building palmsplus</h2>
<p>The palmsplus build process adds additional columns to the input <code>palms</code> dataset shown above. However, the user needs to specify what columns to add, and how to calculate them. This is done by creating a table with the name of the column and the formula used to calculate it. The function <code><a href="../reference/palms_add_field.html">palms_add_field(name, formula, domain_field = FALSE)</a></code> is used to make this table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"duration"</span>,   <span class="st">"1"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"weekday"</span>,    <span class="st">"dow &lt; 6"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"weekend"</span>,    <span class="st">"dow &gt; 5"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"indoors"</span>,    <span class="st">"iov == 3"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"outdoors"</span>,   <span class="st">"iov == 1"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"in_vehicle"</span>, <span class="st">"iov == 2"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"inserted"</span>,   <span class="st">"fixtypecode == 6"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"pedestrian"</span>, <span class="st">"tripmot == 1"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"bicycle"</span>,    <span class="st">"tripmot == 2"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"vehicle"</span>,    <span class="st">"tripmot == 3"</span>)</code></pre></div>
<p>The third parameter <code>domain_field</code> specifies whether the field should be summarized when creating <code>days</code> (see <a href="#building-days">Building days</a> for more info).</p>
<p>Each time you add a new field, a new row is appended to the global <code>palmsplus_fields</code> table. If this table is printed, you will see it contains the fields that were just added:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">palmsplus_fields</code></pre></div>
<table class="table">
<caption>palmsplus_fields</caption>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">formula</th>
<th align="left">domain_field</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">duration</td>
<td align="left">1</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">weekday</td>
<td align="left">dow &lt; 6</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">weekend</td>
<td align="left">dow &gt; 5</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">indoors</td>
<td align="left">iov == 3</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">outdoors</td>
<td align="left">iov == 1</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">in_vehicle</td>
<td align="left">iov == 2</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">inserted</td>
<td align="left">fixtypecode == 6</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">pedestrian</td>
<td align="left">tripmot == 1</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">bicycle</td>
<td align="left">tripmot == 2</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">vehicle</td>
<td align="left">tripmot == 3</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Any variable from the <code>palms</code> dataset can be used to build formulas. However, the true power of <strong>palmsplusr</strong> comes from integrating external data into these calculations.</p>
<p>In the next code snippet, a shapefile that represents home points is read in and buffered by 100m to create polygons. The points and polygons are plotted. This particular person has two homes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">home.points &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="kw">system.file</span>(<span class="st">"extdata/shapefiles/"</span>, <span class="st">"home.shp"</span>, <span class="dt">package =</span> <span class="st">"palmsplusr"</span>))
home.buffer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_buffer.html">palms_buffer</a></span>(<span class="dt">point =</span> home.points, <span class="dt">distance =</span> <span class="dv">100</span>)

<span class="co"># Plot</span>
<span class="kw">plot</span>(home.buffer[, <span class="st">"identifier"</span>], <span class="dt">key.pos =</span> <span class="dv">1</span>)
<span class="kw">plot</span>(home.points[, <span class="st">"identifier"</span>], <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="1-getting-started_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<p>A new field called <em>at_home</em> is added. The formula for this field checks whether each point in <code>palms</code> falls inside these polygons. In the formula, notice how the home.buffer object is filtered by participant identifier. This is so each person is linked with their own home. The last quoted “identifier” dissolves the polygons by identifier. For a more detailed explanation about palmsplus formulas, please see <a href="https://thets.github.io/palmsplusr/articles/3-building-formulas.html">this article</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"at_home"</span>, <span class="st">"palms_in_polygon(., filter(home.buffer, identifier == identifier), </span><span class="ch">\"</span><span class="st">identifier</span><span class="ch">\"</span><span class="st">)"</span>)</code></pre></div>
<p>Once all of the fields have been added, you can build the <code>palmsplus</code> dataset using the <code><a href="../reference/palms_calc_palmsplus.html">palms_calc_palmsplus()</a></code> function. This takes the <code>palms</code> dataset as input:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">palmsplus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_palmsplus.html">palms_calc_palmsplus</a></span>(palms)
<span class="co">#&gt; [1/1] Computed palmsplus for: BC0627</span></code></pre></div>
<p>When printing the column names of the <code>palmsplus</code> dataset, you will notice it contains 24 columns: the original 13 plus the 11 that were added as fields.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(palmsplus)
<span class="co">#&gt;  [1] "identifier"          "datetime"            "dow"                </span>
<span class="co">#&gt;  [4] "fixtypecode"         "iov"                 "tripnumber"         </span>
<span class="co">#&gt;  [7] "triptype"            "tripmot"             "activity"           </span>
<span class="co">#&gt; [10] "activityintensity"   "activityboutnumber"  "sedentaryboutnumber"</span>
<span class="co">#&gt; [13] "duration"            "weekday"             "weekend"            </span>
<span class="co">#&gt; [16] "indoors"             "outdoors"            "in_vehicle"         </span>
<span class="co">#&gt; [19] "inserted"            "pedestrian"          "bicycle"            </span>
<span class="co">#&gt; [22] "vehicle"             "at_home"             "geometry"</span></code></pre></div>
<p>Now that the <code>palmsplus</code> dataset is built, it can be summarized in two ways. Building <a href="#building-days">days</a>, or building <a href="#building-trajectories">trajectories</a>.</p>
<hr>
<p><br><br></p>
</div>
<div id="building-days" class="section level2">
<h2 class="hasAnchor">
<a href="#building-days" class="anchor"></a>Building days</h2>
<p>When building the <code>days</code> dataset, the data are summarized across several <em>domains</em>. These <em>domains</em> need to be specified before <code>days</code> can be built. Domains are added the same way fields are added.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"home"</span>, <span class="st">"at_home"</span>)
<span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"transport"</span>, <span class="st">"pedestrian | bicycle | vehicle"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">palmsplus_domains</code></pre></div>
<table class="table">
<caption>palmsplus_domains</caption>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">formula</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">home</td>
<td align="left">at_home</td>
</tr>
<tr class="even">
<td align="left">transport</td>
<td align="left">pedestrian | bicycle | vehicle</td>
</tr>
</tbody>
</table>
<p>Notice how the domain formulas contain fields created earlier using <code><a href="../reference/palms_add_field.html">palms_add_field()</a></code>. This is possible because the fields table is evaluated before the domains table. It is also important to know that formulas are evaluated in the order they are specified, so one domain formula can contain another domain name.</p>
<p>In a normal workflow, you would add domains before building <code>palmsplus</code>. This is because the <code><a href="../reference/palms_calc_palmsplus.html">palms_calc_palmsplus()</a></code> function seen above adds additional columns to the <code>palmsplus</code> dataset specifying domain membership. The <code>palmsplus</code> dataset is them summarized into days.</p>
<p>Although I built <code>palmsplus</code> earlier, I will need rebuild it so the new domain columns are added.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">palmsplus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_palmsplus.html">palms_calc_palmsplus</a></span>(palms)
<span class="co">#&gt; [1/1] Computed palmsplus for: BC0627</span></code></pre></div>
<p>Now when printing the <code>palmsplus</code> dataset there are 26 columns; two additional ones that represent the two domains.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(palmsplus)
<span class="co">#&gt;  [1] "identifier"          "datetime"            "dow"                </span>
<span class="co">#&gt;  [4] "fixtypecode"         "iov"                 "tripnumber"         </span>
<span class="co">#&gt;  [7] "triptype"            "tripmot"             "activity"           </span>
<span class="co">#&gt; [10] "activityintensity"   "activityboutnumber"  "sedentaryboutnumber"</span>
<span class="co">#&gt; [13] "duration"            "weekday"             "weekend"            </span>
<span class="co">#&gt; [16] "indoors"             "outdoors"            "in_vehicle"         </span>
<span class="co">#&gt; [19] "inserted"            "pedestrian"          "bicycle"            </span>
<span class="co">#&gt; [22] "vehicle"             "at_home"             "home"               </span>
<span class="co">#&gt; [25] "transport"           "geometry"</span></code></pre></div>
<p>The <code><a href="../reference/palms_calc_days.html">palms_calc_days()</a></code> function can now be used to build <code>days</code> from the <code>palmsplus</code> dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">days &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_days.html">palms_calc_days</a></span>(palmsplus)</code></pre></div>
<p>When looking at the first five rows of the <code>days</code> dataset, you will notice that three fields (<em>duration</em>, <em>indoors</em>, and <em>outdoors</em>) are summarized for each domain (<em>home</em> and <em>transport</em>). These three fields were summarized for each domain because they were specified as <code>domain_field = TRUE</code> when they were created (see <a href="#building-palmsplus">Building palmsplus</a> above).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(days, <span class="dt">n =</span> <span class="dv">5</span>)
<span class="co">#&gt; # A tibble: 5 x 8</span>
<span class="co">#&gt;   identifier       date home_duration home_indoors home_outdoors</span>
<span class="co">#&gt;        &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1     BC0627 2013-08-26        348.50            0         79.50</span>
<span class="co">#&gt; 2     BC0627 2013-08-27        929.25            0        532.00</span>
<span class="co">#&gt; 3     BC0627 2013-08-28        651.50            0        494.75</span>
<span class="co">#&gt; 4     BC0627 2013-08-29        353.75            0         57.75</span>
<span class="co">#&gt; 5     BC0627 2013-08-30       1440.00            0        983.50</span>
<span class="co">#&gt; # ... with 3 more variables: transport_duration &lt;dbl&gt;,</span>
<span class="co">#&gt; #   transport_indoors &lt;dbl&gt;, transport_outdoors &lt;dbl&gt;</span></code></pre></div>
<hr>
<p><br><br></p>
</div>
<div id="building-trajectories" class="section level2">
<h2 class="hasAnchor">
<a href="#building-trajectories" class="anchor"></a>Building trajectories</h2>
<p>Building trajectories is very similar to building <code>palmsplus</code>. Variables that you wish to calculate for each trajectory can be specified with the <code>palms_add_trajectoy_field()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"mot"</span>,       <span class="st">"first(tripmot)"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"wear"</span>,      <span class="st">"sum(activityintensity &gt;= 0) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"sedentary"</span>, <span class="st">"sum(activityintensity == 0) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"light"</span>,     <span class="st">"sum(activityintensity == 1) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"moderate"</span>,  <span class="st">"sum(activityintensity == 2) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"vigorous"</span>,  <span class="st">"sum(activityintensity == 3) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"mvpa"</span>,      <span class="st">"moderate + vigorous"</span>)</code></pre></div>
<p>As <code>trajectories</code> are built from the <code>palmsplus</code> dataset, any variables used in the trajectory field formulas should be present in the <code>palmsplus</code> dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trajectory_fields</code></pre></div>
<table class="table">
<caption>trajectory_fields</caption>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">formula</th>
<th align="left">after_conversion</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">mot</td>
<td align="left">first(tripmot)</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">wear</td>
<td align="left">sum(activityintensity &gt;= 0) * epoch</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">sedentary</td>
<td align="left">sum(activityintensity == 0) * epoch</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">light</td>
<td align="left">sum(activityintensity == 1) * epoch</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">moderate</td>
<td align="left">sum(activityintensity == 2) * epoch</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">vigorous</td>
<td align="left">sum(activityintensity == 3) * epoch</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">mvpa</td>
<td align="left">moderate + vigorous</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>The <code>after_conversion</code> parameter dictates whether the fields are calculated before or after the trip points are converted to LINESTRING geometry. Some fields can only be calculated on LINESTRING objects, such as the length of the line:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"length"</span>, <span class="st">"as.numeric(st_length(.))"</span>, <span class="ot">TRUE</span>)</code></pre></div>
<p>The <code><a href="../reference/palms_calc_trajectories.html">palms_calc_trajectories()</a></code> function is used to build trajectories from the <code>palmsplus</code> dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trajectories &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_trajectories.html">palms_calc_trajectories</a></span>(palmsplus)</code></pre></div>
<p>This creates the `trajectories dataset, which has 1 row per trip, each containing the fields created above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(trajectories, <span class="dt">n =</span> <span class="dv">5</span>)
<span class="co">#&gt; Simple feature collection with 5 features and 10 fields</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 174.6976 ymin: -36.80079 xmax: 174.701 ymax: -36.79923</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt;   identifier tripnumber mot wear sedentary light moderate vigorous mvpa</span>
<span class="co">#&gt; 1     BC0627          1   1  180        30    45        0      105  105</span>
<span class="co">#&gt; 2     BC0627          2   1  165         0    75       45       45   90</span>
<span class="co">#&gt; 3     BC0627          3   1  555        60   285      150       60  210</span>
<span class="co">#&gt; 4     BC0627          4   1  255        60   135       45       15   60</span>
<span class="co">#&gt; 5     BC0627          5   1  675         0   435      195       45  240</span>
<span class="co">#&gt;     length                       geometry</span>
<span class="co">#&gt; 1 198.3973 LINESTRING (174.69962969 -3...</span>
<span class="co">#&gt; 2 125.4967 LINESTRING (174.69970838 -3...</span>
<span class="co">#&gt; 3 518.3824 LINESTRING (174.70103566 -3...</span>
<span class="co">#&gt; 4 128.9889 LINESTRING (174.69827459 -3...</span>
<span class="co">#&gt; 5 400.8963 LINESTRING (174.69794882 -3...</span></code></pre></div>
<p>You will also notice the <code>trajectories</code> dataset contains LINESTRING geometry. This means we can plot it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(trajectories[, <span class="st">"mot"</span>], <span class="dt">pal =</span> <span class="kw">c</span>(<span class="st">"orange"</span>, <span class="st">"blue"</span>), <span class="dt">key.pos =</span> <span class="ot">NULL</span>)

<span class="co"># Add the home buffer polygons to the plot</span>
<span class="kw">plot</span>(home.buffer[, <span class="dv">1</span>], <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">key.pos =</span> <span class="ot">NULL</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="1-getting-started_files/figure-html/unnamed-chunk-23-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The last component of building trajectories is adding trip start and end locations. This is useful when you want to identify specific trips, such as trips to work or school. This is done with the function <code><a href="../reference/palms_add_trip_location.html">palms_add_trip_location(name, start_criteria, end_criteria)</a></code>.</p>
<p>The <code>start_criteria</code> and <code>end_criteria</code> parameters should be fields already calculated in <code>palmsplus</code>. This is required so variables only have to be calculated once (i.e., when <code>palmsplus</code> is built). This results in a significant performance benefit.</p>
<p>The following example is a trip that starts and ends <em>at_home</em> (i.e., inside the home.buffer).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/palms_add_trip_location.html">palms_add_trip_location</a></span>(<span class="st">"home_home"</span>, <span class="st">"at_home"</span>, <span class="st">"at_home"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trajectory_locations</code></pre></div>
<table class="table">
<caption>trajectory_locations</caption>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">start_criteria</th>
<th align="left">end_criteria</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">home_home</td>
<td align="left">at_home</td>
<td align="left">at_home</td>
</tr></tbody>
</table>
<p>Now the <code>trajectories</code> dataset can be rebuilt. Additional columns will be added for each trip location:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trajectories &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_trajectories.html">palms_calc_trajectories</a></span>(palmsplus)
<span class="kw">names</span>(trajectories)
<span class="co">#&gt;  [1] "identifier" "tripnumber" "mot"        "wear"       "sedentary" </span>
<span class="co">#&gt;  [6] "light"      "moderate"   "vigorous"   "mvpa"       "home_home" </span>
<span class="co">#&gt; [11] "length"     "geometry"</span></code></pre></div>
<p>Notice how the <code>trajectories</code> dataset now contains an extra column <code>home_home</code> which signifies whether the trip started and ended at home.</p>
<hr>
<p><br><br></p>
</div>
<div id="saving-geometry-and-results" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-geometry-and-results" class="anchor"></a>Saving geometry and results</h2>
<p>You can save all datasets as a csv file. As <code>palmsplus</code> and <code>trajecories</code> contain geometry, you can also save these as a ESRI shapefile:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(days, <span class="st">"palmsplus.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
<span class="kw">write.csv</span>(days, <span class="st">"days.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
<span class="kw">write.csv</span>(days, <span class="st">"trajectories.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)

<span class="kw">st_write</span>(palmsplus, <span class="st">"palmsplus.shp"</span>)
<span class="kw">st_write</span>(trajectories, <span class="st">"trajecories.shp"</span>)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#loading-palms">Loading the PALMS dataset</a></li>
      <li><a href="#building-palmsplus">Building palmsplus</a></li>
      <li><a href="#building-days">Building days</a></li>
      <li><a href="#building-trajectories">Building trajectories</a></li>
      <li><a href="#saving-geometry-and-results">Saving geometry and results</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Tom Stewart.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
