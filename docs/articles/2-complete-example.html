<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A complete example â€¢ palmsplusr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">palmsplusr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="../articles/1-getting-started.html">Getting started</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="http://github.com/TheTS/palmsplusr/">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>A complete example</h1>
            
            <h4 class="date">2018-01-01</h4>
          </div>

    
    
<div class="contents">
<div id="reading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-data" class="anchor"></a>Reading data</h2>
<p>It is wise to read in all data that you will need at the beginning. This includes the PALMS dataset, and any other shapefiles and csv files. Any geoprocessing, such as buffering can also be done here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(palmsplusr)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(sf)

<span class="co"># Load PALMS dataset</span>
palms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_palms.html">read_palms</a></span>(<span class="st">"D:/data/csv/palms_output_test.csv"</span>)

<span class="co"># Load other csvs</span>
participant_basis &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"D:/data/csv/participant_basis.csv"</span>)
class_timetable &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"D:/data/csv/class_timetable.csv"</span>)

<span class="co"># Load shapefiles</span>
home &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="st">"D:/shapefiles/home.shp"</span>)
school &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="st">"D:/shapefiles/school.shp"</span>)

<span class="co"># Buffer home points</span>
home.buffer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_buffer.html">palms_buffer</a></span>(<span class="dt">point =</span> home, <span class="dt">distance =</span> <span class="dv">100</span>, <span class="dt">crs =</span> <span class="dv">2193</span>)</code></pre></div>
</div>
<div id="creating-field-domain-and-trajectory-location-tables" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-field-domain-and-trajectory-location-tables" class="anchor"></a>Creating field, domain, and trajectory location tables</h2>
<p>This section is the bulk of the setup. All formulas for building <code>palmsplus</code>, <code>days</code>, and <code>trajectories</code> are created. Notice that some fields are domain_fields so they will be aggregated for each domain when <code>days</code> is built.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># palmsplus fields (from palms dataset)</span>
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"duration"</span>,   <span class="st">"1"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"weekday"</span>,    <span class="st">"dow &lt; 6"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"weekend"</span>,    <span class="st">"dow &gt; 5"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"indoors"</span>,    <span class="st">"iov == 3"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"outdoors"</span>,   <span class="st">"iov == 1"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"in_vehicle"</span>, <span class="st">"iov == 2"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"inserted"</span>,   <span class="st">"fixtypecode == 6"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"pedestrian"</span>, <span class="st">"tripmot == 1"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"bicycle"</span>,    <span class="st">"tripmot == 2"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"vehicle"</span>,    <span class="st">"tripmot == 3"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"nonwear"</span>,    <span class="st">"activityintensity &lt; 0"</span>,  <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"wear"</span>,       <span class="st">"activityintensity &gt;= 0"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"sedentary"</span>,  <span class="st">"activityintensity == 0"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"light"</span>,      <span class="st">"activityintensity == 1"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"moderate"</span>,   <span class="st">"activityintensity == 2"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"vigorous"</span>,   <span class="st">"activityintensity == 3"</span>, <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"mvpa"</span>,       <span class="st">"activityintensity &gt; 1"</span>,  <span class="ot">TRUE</span>)

<span class="co"># palmsplus fields (from other files)</span>
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"in_school_time"</span>, <span class="st">"palms_in_time(., i, class_timetable, participant_basis, </span><span class="ch">\"</span><span class="st">school_start</span><span class="ch">\"</span><span class="st">, </span><span class="ch">\"</span><span class="st">school_end</span><span class="ch">\"</span><span class="st">)"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"in_recess1"</span>,     <span class="st">"palms_in_time(., i, class_timetable, participant_basis, </span><span class="ch">\"</span><span class="st">recess1_start</span><span class="ch">\"</span><span class="st">, </span><span class="ch">\"</span><span class="st">recess1_end</span><span class="ch">\"</span><span class="st">)"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"in_recess2"</span>,     <span class="st">"palms_in_time(., i, class_timetable, participant_basis, </span><span class="ch">\"</span><span class="st">recess2_start</span><span class="ch">\"</span><span class="st">, </span><span class="ch">\"</span><span class="st">recess2_end</span><span class="ch">\"</span><span class="st">)"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"at_home"</span>,        <span class="st">"palms_in_polygon(., filter(home.buffer, identifier == i), </span><span class="ch">\"</span><span class="st">identifier</span><span class="ch">\"</span><span class="st">)"</span>)
<span class="kw"><a href="../reference/palms_add_field.html">palms_add_field</a></span>(<span class="st">"at_school"</span>,      <span class="st">"palms_in_polygon(., filter(school, school_id == participant_basis %&gt;% filter(identifier == i) %&gt;% pull(school_id)))"</span>)

<span class="co"># days domains</span>
<span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"d_all"</span>,       <span class="st">"1"</span>)
<span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"d_home"</span>,      <span class="st">"at_home"</span>)
<span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"d_school"</span>,    <span class="st">"(!at_home &amp; at_school &amp; in_school_time)"</span>)
<span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"d_transport"</span>, <span class="st">"!at_home &amp; !(at_school &amp; in_school_time) &amp; (pedestrian | bicycle | vehicle)"</span>)
<span class="kw"><a href="../reference/palms_add_domain.html">palms_add_domain</a></span>(<span class="st">"d_leisure"</span>,   <span class="st">"!at_home &amp; !(at_school &amp; in_school_time) &amp; !pedestrian &amp; !bicycle &amp; !vehicle"</span>)

<span class="co"># trajectory fields</span>
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"mot"</span>,       <span class="st">"first(tripmot)"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"date"</span>,      <span class="st">"first(as.Date(datetime))"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"start"</span>,     <span class="st">"datetime[triptype==1]"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"end"</span>,       <span class="st">"datetime[triptype==4]"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"duration"</span>,  <span class="st">"as.numeric(difftime(end, start, units = </span><span class="ch">\"</span><span class="st">secs</span><span class="ch">\"</span><span class="st">) + epoch)"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"nonwear"</span>,   <span class="st">"sum(activityintensity &lt; 0) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"wear"</span>,      <span class="st">"sum(activityintensity &gt;= 0) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"sedentary"</span>, <span class="st">"sum(activityintensity == 0) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"light"</span>,     <span class="st">"sum(activityintensity == 1) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"moderate"</span>,  <span class="st">"sum(activityintensity == 2) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"vigorous"</span>,  <span class="st">"sum(activityintensity == 3) * epoch"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"mvpa"</span>,      <span class="st">"moderate + vigorous"</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"length"</span>,    <span class="st">"as.numeric(st_length(.))"</span>,  <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/palms_add_trajectory_field.html">palms_add_trajectory_field</a></span>(<span class="st">"speed"</span>,     <span class="st">"(length / duration) * 3.6"</span>, <span class="ot">TRUE</span>)

<span class="co"># trajectory locations</span>
<span class="kw"><a href="../reference/palms_add_trip_location.html">palms_add_trip_location</a></span>(<span class="st">"home_school"</span>,   <span class="st">"at_home"</span>,   <span class="st">"at_school"</span>)
<span class="kw"><a href="../reference/palms_add_trip_location.html">palms_add_trip_location</a></span>(<span class="st">"school_home"</span>,   <span class="st">"at_school"</span>, <span class="st">"at_home"</span>)
<span class="kw"><a href="../reference/palms_add_trip_location.html">palms_add_trip_location</a></span>(<span class="st">"home_home"</span>,     <span class="st">"at_home"</span>,   <span class="st">"at_home"</span>)
<span class="kw"><a href="../reference/palms_add_trip_location.html">palms_add_trip_location</a></span>(<span class="st">"school_school"</span>, <span class="st">"at_school"</span>, <span class="st">"at_school"</span>)</code></pre></div>
</div>
<div id="build-palmsplus-days-and-trajectories" class="section level2">
<h2 class="hasAnchor">
<a href="#build-palmsplus-days-and-trajectories" class="anchor"></a>Build palmsplus, days, and trajectories</h2>
<p>Once all of the formula tables are created, it is very simple to build palmsplus, and then create days and trajectories.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Build palmsplus</span>
palmsplus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_palmsplus.html">palms_calc_palmsplus</a></span>(palms)

<span class="co"># Build days</span>
days &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_days.html">palms_calc_days</a></span>(palmsplus)

<span class="co"># Build trajectories</span>
trajectories &lt;-<span class="st"> </span><span class="kw"><a href="../reference/palms_calc_trajectories.html">palms_calc_trajectories</a></span>(palmsplus)</code></pre></div>
</div>
<div id="saving-results" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-results" class="anchor"></a>Saving results</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(palmsplus, <span class="st">"palmsplus.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
<span class="kw">write.csv</span>(days, <span class="st">"days.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
<span class="kw">write.csv</span>(trajectories, <span class="st">"trajectories.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)

<span class="kw">st_write</span>(palmsplus, <span class="st">"palmsplus.shp"</span>)
<span class="kw">st_write</span>(trajectories, <span class="st">"trajecories.shp"</span>)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#reading-data">Reading data</a></li>
      <li><a href="#creating-field-domain-and-trajectory-location-tables">Creating field, domain, and trajectory location tables</a></li>
      <li><a href="#build-palmsplus-days-and-trajectories">Build palmsplus, days, and trajectories</a></li>
      <li><a href="#saving-results">Saving results</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Tom Stewart.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
